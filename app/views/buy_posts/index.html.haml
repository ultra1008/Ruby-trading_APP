= content_for :page_js do
  :javascript

= render 'partials/navbar'

%div{:class => "uk-section lta-section-header"}
  .uk-container.uk-text-center
    %h1
      What people are
      %span.lta-text-blue
        buying


%div{:class => "uk-section"}
  %div{:class => "uk-container uk-container-small", "uk-height-viewport" => "expand: true"}

    = button_to 'Post Your Request', new_buy_post_path, method: "get"

    %hr

    = form_tag buy_posts_path, :id => :category_form, :method => :get do
      Categories:
      - @all_categories.each do |category|
        -if category != nil
          = category
          = check_box_tag "categories[#{category}]", 1, session[:categories].include?(category)
        - else
          Uncategorized
          = check_box_tag "categories[nil]", 1, session[:categories].include?(category)
      = submit_tag 'Refresh'


      %table.uk-table
        %thead
          %tr
            - @columns.each do |column|
              - if column[:sort_allowed]
                - if session[:sorted_key] == column[:id].to_s
                  %th{:class => :hilite}
                    = link_to column[:name], buy_posts_path(:sorted => "nil"), id: column[:id].to_s + "_header"
                -else
                  %th= link_to column[:name], buy_posts_path(:sorted => column[:id]), id: column[:id].to_s + "_header"
              - else
                %th= column[:name]
        %tbody
          - @buy_posts.each do |post|
            %tr
              - @columns.each do |column|
                - if column[:id] == :title
                  %td= link_to post.title.presence || "(no title)", buy_post_path(post.id)
                - elsif column[:name] == :upload_image
                  - if post.upload_image.attached?
                    %td= image_tag(post.upload_image, size: '50x50')
                - else
                  %td= post.send column[:id]

= render 'partials/footer'
